---
title: "Final Summer Output Graphs"
---

# Motivation 

With Eben's adjustment and addition to the QuantAQ data, we are ready to create the final figures for our paper. In this notebook, I generate those figures.

The figures which we are generating are: polar plots, diurnal profiles, boxplots 

# Importing & Cleaning Data 

First, I will import the new datasets from QuantAQ as well as a new meteorological dataset to include

```{r}
main_path <- "C:/Users/abusa/Documents/GitHub/EB_AQ_Network/Fall2020/data/complete_dataset" #path to files 
final_vars <- c( "timestamp","timestamp_local",  "temp_manifold", 
                 "co", "no" , "no2", "o3" ,  "pm1" , "pm25","pm10", "co2" ) #final variables to keep 
raw_vars <- c("bin0", "no_ae") #raw variables to keep


#finding all final datasets 
temp = list.files(path = main_path, pattern = "^.*final_final.*\\.csv", full.names = TRUE)
finalfiles = lapply(temp, function(x) fread(file=x, select = final_vars) )

#finding all raw datasets
temp = list.files(path = main_path, pattern = "^.*final_raw.*\\.csv", full.names = TRUE)
rawfiles = lapply(temp, function(x) fread(file=x) ) #select = c("Year","Jan","Feb","Mar","Apr","May","Jun")

sn45 <- cbind(finalfiles[[1]], rawfinals[[1]])
sn49 <- cbind(finalfiles[[2]], rawfinals[[2]])
sn62 <- cbind(finalfiles[[3]], rawfinals[[3]])
sn67 <- cbind(finalfiles[[4]], rawfinals[[4]])
sn72 <- cbind(finalfiles[[5]], rawfinals[[5]])


```


Next, I will prepare the data, using the pipeline developed during the summer 

```{r}
source("functions/format_medata.R")
metdata <- fread("data/metdata.csv", header=TRUE, fileEncoding="UTF-8-BOM") #import meteorology file
metdata <- format_METtime(metdata)
setDT(metdata, key = "date")
```


```{r}
source("functions/final_data_cleaning_noNO2model.R")

sn45 <- final_data_cleaning_sansNO2(sn45, metdata)
sn49 <- final_data_cleaning_sansNO2(sn49, metdata)
sn62 <- final_data_cleaning_sansNO2(sn62, metdata)
sn67 <- final_data_cleaning_sansNO2(sn67, metdata)
sn72 <- final_data_cleaning_sansNO2(sn72, metdata)

fwrite(sn45, "data/sn45.csv", na = "na")

```


# Polar Plots 

I will generate CO, CO2, NO, NO2, PM1 and PM2.5 polar plots for all the available sensors. All the polar plots for a given sensor will be stored in one pdf. 

The polar plot function being used comes from Openair.

```{r}
generate_overall_polarplots <- function(sn, snstring){
  #generates the polar plots for the variables we are interested in 
  polarPlot(sn, pollutant = "correctedNO", main = pastet0(snstring, "NO Polar Plot", sep= " "))
  polarPlot(sn, pollutant = "no2", main = pastet0(snstring, "NO Polar Plot", sep= " "))
  polarPlot(sn, pollutant = "co",  main = pastet0(snstring, "NO Polar Plot", sep= " "))
  polarPlot(sn, pollutant = "bin0",  main = pastet0(snstring, "NO Polar Plot", sep= " "))
  polarPlot(sn, pollutant = "pm1",  main = pastet0(snstring, "NO Polar Plot", sep= " "))

}
```

```{r}
pdf("polar-sn45.pdf")
generate_overall_polarplots(sn45, "SN 45")
dev.off()

pdf("polar-percentile-plots-sn49.pdf")
generate_overall_polarplots(sn49, "SN 49")
dev.off()

pdf("polar-percentile-plots-sn62.pdf")
generate_overall_polarplots(sn62, "SN 62")
dev.off()

pdf("polar-percentile-plots-sn67.pdf")
generate_overall_polarplots(sn67, "SN 67")
dev.off()
```

# Diurnal Profiles 

Similarly, I will generate Diurnal Profiles for all available sensors using the diurnal profile Openair method. 

```{r}
for(sensor in snfiles){
  timeVariation(sensor, pollutant = c("CorrectedNO", "co", "no", "no2"))
}
```



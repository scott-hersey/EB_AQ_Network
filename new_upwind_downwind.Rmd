---
title: "9/2020 Upwind/Downwind Definitions"
---

# Motivation 

Based on the work from the summer, the updated downwind definitions from polarPlots and discussions we've had, we've decided to implement a different version from downwind definitions. We are doing this because we've identified there to be two circumstances in which elevated pollutant concentrations manifest themselves. 
1. There are elevated concentrations when downwind of the airport, in a narrow ban of wind directions 
2. There are elevated concentrations in all wind directions during periods of low wind directions. 

This second type contains airport 

# importing 

```{r message=FALSE, warning=FALSE}
library(lubridate)
library(openair)
library(data.table)
library(dplyr)
library(baseline)
library(Rmisc)
```


```{r}
sn45 <-fread("data/sn45filt.csv", header= TRUE)
sn45$date <- ymd_hms(sn45$date,  tz = "America/New_York")

sn49 <- fread("data/sn49filt.csv", sep = ",")
sn49$date <- ymd_hms(sn49$date, tz = "America/New_York")

sn62 <- fread("data/sn62filt.csv", header= TRUE)
sn62$date <- ymd_hms(sn62$date,  tz = "America/New_York")

sn67 <- fread("data/sn67filt.csv", header= TRUE)
sn67$date <- ymd_hms(sn67$date,  tz = "America/New_York")
```




# dividing datasets by wind speed 

```{r}
sn45_low <- subset(sn45, sn45$ws < 2.5)
sn49_low <- subset(sn49, sn49$ws < 2.5)
sn62_low <- subset(sn62, sn62$ws < 2.5)
sn67_low <- subset(sn67, sn67$ws < 2.5)
```

# dividng datasets by wind direction 

```{r}
upwind_downwind_data <- function(sn, dw1, dw2){
  downwind <- subset(sn, sn$wd > dw1 & sn$wd < dw2)
  upwind <- setdiff(sn, downwind)
  return(list("upwind" = upwind, "downwind" = downwind))
}
```

```{r}
sn45_uwdw <- upwind_downwind_data(sn45, 140, 180)
sn49_uwdw <- upwind_downwind_data(sn49, 110, 180)
sn62_uwdw <- upwind_downwind_data(sn62, 230, 290)
sn67_uwdw <- upwind_downwind_data(sn67, 110, 160)

```

# Exporting Datasets 

```{r}
write_csv <-function(sn, snlow, snname){
  write.csv(snlow, paste(snname, "dw1.csv", sep ="_"),row.names = FALSE )
  write.csv(sn[["downwind"]], paste(snname, "dw2.csv", sep ="_"),row.names = FALSE )
  write.csv(sn[["upwind"]], paste(snname, "uw.csv", sep ="_"),row.names = FALSE )
}
```


```{r}
write_csv(sn45_uwdw, sn45_low, "sn45")
write_csv(sn49_uwdw, sn49_low, "sn49")
write_csv(sn62_uwdw, sn62_low, "sn62")
write_csv(sn67_uwdw, sn67_low, "sn67")
```


